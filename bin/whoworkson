#!/usr/bin/perl
use strict;
use warnings;
use WhosThat;
use Data::Dumper;

usage() unless $ARGV[0];
my $what = lc($ARGV[0]);
my @peeps = WhosThat::listwho();

# Is that a project?
if ( my $proj = WhosThat->loadproject($what) ) {
    foreach my $who (@peeps) {
        if ( grep( /$what/i, @{$who->{projects}} ) ) {
            displaywho($who);
        }
    }

# ... or a service?
} elsif ( my $service = WhosThat->loadservice($what) ) {
    foreach my $who (@peeps) {
        if ( grep( $what, @{$who->{services}} ) ) {
            displaywho($who);
        }
    }
} else {
    print "Didn't find a project, service, or team named that.\n";
}

sub usage {
    print "Usage:\n\t$0 project_or_service_name\n";
    exit();
}

sub displaywho {
    my $who = shift;

    print $who->{name} . " " . $who->{email};
    if ( $who->{alias} ) {
        print ' - ' . $who->{phonetool};
    }
    print "\n";
}
