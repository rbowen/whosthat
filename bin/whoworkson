#!/usr/bin/perl
use strict;
use warnings;
use WhosThat;
use Data::Dumper;

usage() unless $ARGV[0];
my $what = lc($ARGV[0]);
my @peeps = WhosThat::listwho();

# Is that a project?
if ( my $proj = WhosThat->loadproject($what) ) {
    foreach my $who (@peeps) {
        if ( grep( /$what/i, @{$who->{projects}} ) ) {
            displaywho($who);
        }
    }

# ... or a team?
} elsif ( my $team = WhosThat->loadteam($what) ) {
    foreach my $who (@peeps) {
        if ( grep( /$what/i, @{$who->{teams}} ) ) {
            displaywho($who);
        }
    }
} else {
    print "Didn't find a project or team named that.\n";
}
print "\n";

sub usage {
    print "Usage:\n\t$0 project_or_team_name\n";
    exit();
}

sub displaywho {
    my $who = shift;

    print "\n" . $who->{name} . "\n"; 
    print $who->{email};
    if ( $who->{alias} ) {
        print ' - ' . $who->{phonetool};
    }
    if (defined($who->{title}) && ($who->{title} !~ /fixme/)) {
        print "\n" .$who->{title};
    }
    print "\n";
}
